<!DOCTYPE html>
<html lang="en">
  <head>
    <title>async/await与promise</title>
  </head>
  <body>
    <script>
      async function f() {
        var a1 = new Promise((resolve, reject) => {
          console.log("a1");
          setTimeout(() => {
            console.log("a11");
            resolve("1");
          }, 2000);
        });
        var a2 = new Promise((resolve, reject) => {
          console.log("a2");
          setTimeout(() => {
            console.log("a22");
            resolve("2");
          }, 5000);
        });
        //a1,a2异步同步执行
        //输出a1
        //输出a2

        let foo1 = await a1; //两秒后输出1
        let foo2 = await a2; //输出1后3秒输出2
        //然后执行下面循环
        for (const x of [foo1, foo2]) {
          console.log(x);
        }
        // 22:02:15.383  a1
        // 22:02:15.383  a2
        // 22:02:17.384  a11
        // 22:02:20.384  a22
        // 22:02:20.384  1
        // 22:02:20.384  2
      }

      async function f0() {
        var a1 = await new Promise((resolve, reject) => {
          console.log("a1");
          setTimeout(() => {
            console.log("a11");
            resolve("1");
          }, 2000);
        });
        var a2 = await new Promise((resolve, reject) => {
          console.log("a2");
          setTimeout(() => {
            console.log("a22");
            resolve("2");
          }, 5000);
        });
        for (const x of [a1, a2]) {
          console.log(x);
        }
        //先执行a1打印a1,2秒后打印a11。再执行a2打印a2,5秒后打印a22。再执行for循环输出两个值
        // 22:17:07.077 a1
        // 22:17:09.079 a11
        // 22:17:09.080 a2
        // 22:17:14.082 a22
        // 22:17:14.082 1
        // 22:17:14.083 2
      }

      async function f1() {
        var a1 = new Promise((resolve, reject) => {
          setTimeout(() => {
            console.log("a1");
            resolve("1");
          }, 2000);
        });
        var a2 = new Promise((resolve, reject) => {
          setTimeout(() => {
            console.log("a2");
            resolve("2");
          }, 5000);
        });
        for (const x of [a1, a2]) {
          console.log(x);
        }
        //同步先执行a1,a2,再执行for循环输出两个等待的promise
        // 22:05:52.319  Promise {<pending>}
        // 22:05:52.319  Promise {<pending>}
        // 22:05:54.320  a1
        // 22:05:57.320  a2
      }

      async function f2() {
        var a1 = new Promise((resolve, reject) => {
          setTimeout(() => {
            console.log("a1");
            resolve("1");
          }, 5000);
        });
        var a2 = new Promise((resolve, reject) => {
          setTimeout(() => {
            console.log("a2");
            resolve("2");
          }, 2000);
        });
        for await (const x of [a1, a2]) {
          console.log(x);
        }
        //同步先执行a1,a2,2秒后打印a2,等待a1返回,之后打印a1.再执行for循环输出两个值
        // 22:11:49.340 a2
        // 22:11:52.338 a1
        // 22:11:52.339 1
        // 22:11:52.339 2
      }

      async function x() {
        for (const x of [1, 2, 3]) {
          var t = await new Promise((resolve, reject) => {
            console.log(x);
            setTimeout(() => {
              console.log(x, 1);
              resolve("x" + x);
            }, 3000);
          });
          console.log(t);
        }
        // 22:49:09.689 1
        // 22:49:12.689 1 1
        // 22:49:12.690 x1
        // 22:49:12.690 2
        // 22:49:15.692 2 1
        // 22:49:15.692 x2
        // 22:49:15.692 3
        // 22:49:18.694 3 1
        // 22:49:18.694 x3
      }

      async function y() {
        [0, 1, 2].forEach(async function(x) {
          var t = await new Promise((resolve, reject) => {
            console.log(x);
            setTimeout(() => {
              console.log(x, 1);
              resolve("x" + x);
            }, 2000);
          });
          console.log(t);
        });
        // 22:54:09.299 0
        // 22:54:09.299 1
        // 22:54:09.300 2
        // 22:54:11.301 0 1
        // 22:54:11.301 x0
        // 22:54:11.302 1 1
        // 22:54:11.302 x1
        // 22:54:11.302 2 1
        // 22:54:11.303 x2
      }


      async function* asyncGenerator(){
        console.log('start')
        const result=await new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve(1)
            console.log(3)
          }, 2000);
        });
        yield 'result'+result;
        console.log('done')
      }
      // asyncGenerator().next().then(data=>{
      //   console.log(data)
      // })
      //先输出start，然后等待2秒打印3，然后next返回打印data
      // 23:42:09.615 start
      // 23:42:11.606 3
      // 23:42:11.607 {value: "result1", done: false}

      async function* gen1(){
        yield 'a';
        yield 'b';
        return 2
      }
      async function* gen2(){
        const result=yield* gen1();
      }

      //Uncaught (in promise) TypeError: gen1 is not a function or its return value is not iterable
      for await(const x of gen1()){
        console.log(x)
      }

      async function yy(){
        for await(const x of gen2()){
          console.log(x)
        }
      }
      //a
      //b
    </script>
  </body>
</html>
